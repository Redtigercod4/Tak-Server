"use strict";(self.webpackChunkdocusaurus_static=self.webpackChunkdocusaurus_static||[]).push([[2547],{2952:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>l});var n=r(5893),s=r(1151);const i={},a="Appendix B: Certificate Generation",o={id:"appendixb",title:"Appendix B: Certificate Generation",description:"TAK Server includes scripts for generating a private security enclave, which will create a Certificate Authority (CA) as well as server and client certificates.",source:"@site/docs/appendixb.md",sourceDirName:".",slug:"/appendixb",permalink:"/docs/appendixb",draft:!1,unlisted:!1,editUrl:"https://gitlab.com/octospacc/editocttrialTools/-/blob/main/docusaurus-static/docs/appendixb.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Appendix A: Acronyms and Abbreviations",permalink:"/docs/appendixa"},next:{title:"Appendix C: Certificate Signing",permalink:"/docs/appendixc"}},c={},l=[{value:"Configure TAK Server Certificate",id:"configure-tak-server-certificate",level:2},{value:"Installing Client Certificates",id:"installing-client-certificates",level:2}];function d(e){const t={code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"appendix-b-certificate-generation",children:"Appendix B: Certificate Generation"}),"\n",(0,n.jsx)(t.p,{children:"TAK Server includes scripts for generating a private security enclave, which will create a Certificate Authority (CA) as well as server and client certificates."}),"\n",(0,n.jsx)(t.p,{children:"First, figure out how many client certificates you are going to need. Ideally you should have a different client cert for each ATAK device on your network."}),"\n",(0,n.jsx)(t.p,{children:"Become the tak user:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"sudo su tak\n"})}),"\n",(0,n.jsx)(t.p,{children:"Edit the certificate-generation configuration file, at this  location:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"/opt/tak/certs/cert-metadata.sh\n"})}),"\n",(0,n.jsx)(t.p,{children:"Set options for country, state, city, organization, and organizational_unit."}),"\n",(0,n.jsx)(t.p,{children:"Change directory:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"cd /opt/tak/certs\n"})}),"\n",(0,n.jsx)(t.p,{children:"Create a certificate authority (CA):"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"./makeRootCa.sh\n"})}),"\n",(0,n.jsx)(t.p,{children:"Follow the prompt to name the CA."}),"\n",(0,n.jsx)(t.p,{children:"Create a server certificate:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"./makeCert.sh server takserver\n"})}),"\n",(0,n.jsx)(t.p,{children:"This command will result in a server certificate named '/opt/tak/certs/files/takserver.jks'"}),"\n",(0,n.jsx)(t.p,{children:"Create one or more client certificates. You should use a different client cert for each ATAK device on your network. This username will be provisioned in the certificate as the CN (Common Name). When using certs on devices that are connected to an input that is configured for group filtering without authentication messages, this username will be used by TAK Server to look up group membership information in an authentication repository, such as Active Directory (AD). This command will create a cert for the username user:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"./makeCert.sh client user\n"})}),"\n",(0,n.jsx)(t.p,{children:"Generate another cert, named admin to access the admin UI:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"./makeCert.sh client admin\n"})}),"\n",(0,n.jsx)(t.p,{children:"The generated CA truststores and certs will be located here:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"/opt/tak/certs/files\n"})}),"\n",(0,n.jsx)(t.p,{children:'Follow the instruction on "Configure TAK Server Certificate" to set up the server to use the generated certs and to authenticate users on a TLS port. If using the default configuration, TLS will be correctly set up on 8443.'}),"\n",(0,n.jsx)(t.p,{children:"Become a normal user:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"exit\n"})}),"\n",(0,n.jsx)(t.p,{children:"Restart the TAK Server:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"sudo systemctl restart takserver\n"})}),"\n",(0,n.jsx)(t.p,{children:"Authorize the admin cert to perform administrative functions using the UI:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"sudo java -jar /opt/tak/utils/UserManager.jar certmod -A /opt/tak/certs/files/admin.pem\n"})}),"\n",(0,n.jsx)(t.h2,{id:"configure-tak-server-certificate",children:"Configure TAK Server Certificate"}),"\n",(0,n.jsx)(t.p,{children:"In /opt/tak, check the following settings in CoreConfig.xml:"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsx)(t.li,{children:"In the <tls> element, the keystoreFile attribute should be set to the server keystore that was generated with makeCerts.sh, above. If you followed the instructions verbatim, the server keystore is '/opt/tak/certs/files/takserver.jks'."}),"\n",(0,n.jsx)(t.li,{children:"Also in the <tls> element, the truststoreFile attribute should be set to the the trust store that was generated with makeCerts.sh, above. If you used the default arguments, your trust store file is '/opt/tak/certs/files/truststore-root.jks'."}),"\n",(0,n.jsx)(t.li,{children:"In the <network> element, add a TLS input, specifying group-based filtering without requiring an authentication message:"}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:'<input _name="stdssl" protocol="tls" port="8089" auth="x509"/>\n'})}),"\n",(0,n.jsx)(t.p,{children:"You can change the port number if you want.\nExample:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:'<network multicastTTL="5">\n  \x3c!-- <input _name="stdtcp" protocol="tcp" port="8087"/> --\x3e\n  \x3c!-- <input _name="stdudp" protocol="udp" port="8087"/> --\x3e\n  <input _name="stdssl" protocol="tls" port="8089" auth="x509"/>\n  \x3c!-- <input _name="streamtcp" protocol="stcp" port="8088"/> --\x3e\n  \x3c!-- <input _name="SAproxy" protocol="mcast" group="239.2.3.1" port="6969" proxy="true"/> --\x3e\n  \x3c!-- <input _name="GeoChatproxy" protocol="mcast" group="224.10.10.1" port="17012" proxy="true"/> --\x3e\n  \x3c!--<announce enable="true" uid="Marti1" group="239.2.3.1" port="6969" interval="1" ip="192.168.1.137" />--\x3e\n</network>\n...\n<security>\n  <tls context="TLSv1" keymanager="SunX509" keystore="JKS" keystoreFile="certs/files/takserver.jks" keystorePass="atakatak" truststore="JKS" truststoreFile="certs/files/truststore-root.jks" truststorePass="atakatak">\n  (Uncomment the following if you are using a CRL)\n  \x3c!-- <crl _name="Marti CA" crlFile="certs/ca.crl"/>  --\x3e\n  </tls>\n</security>\n'})}),"\n",(0,n.jsx)(t.p,{children:"Then (re)start the TAK Server as normal."}),"\n",(0,n.jsx)(t.h2,{id:"installing-client-certificates",children:"Installing Client Certificates"}),"\n",(0,n.jsx)(t.p,{children:"Take the truststore-root.p12 and user.p12 files and copy them to your Android device.  In ATAK, open 'Settings -> General Settings -> Network Settings' and set the SSL/TLS Truststore and Client Certificate preferences to point to those .p12 files."}),"\n",(0,n.jsx)(t.p,{children:"Repeat the procedure described above for creating a new server connection, but be sure to select SSL as the protocol."}),"\n",(0,n.jsx)(t.p,{children:"These same .p12 files can be installed in a browser, and used to access the Web UI (for admin use) and WebTAK (for normal users or admins). The process to install these files varies by browser and operating system, but can generally be configured by going to the browser preferences, and the security or certificates section."})]})}function h(e={}){const{wrapper:t}={...(0,s.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},1151:(e,t,r)=>{r.d(t,{Z:()=>o,a:()=>a});var n=r(7294);const s={},i=n.createContext(s);function a(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);