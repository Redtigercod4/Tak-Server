"use strict";(self.webpackChunkdocusaurus_static=self.webpackChunkdocusaurus_static||[]).push([[1925],{1563:(e,s,a)=>{a.r(s),a.d(s,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>i});var r=a(5893),n=a(1151);const t={},o="Two-Server Upgrade",l={id:"upgrade/twoserver",title:"Two-Server Upgrade",description:"Rocky Linux 8",source:"@site/docs/upgrade/twoserver.md",sourceDirName:"upgrade",slug:"/upgrade/twoserver",permalink:"/docs/upgrade/twoserver",draft:!1,unlisted:!1,editUrl:"https://gitlab.com/octospacc/editocttrialTools/-/blob/main/docusaurus-static/docs/upgrade/twoserver.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Single-Server Upgrade",permalink:"/docs/upgrade/singleserver"},next:{title:"IronBank",permalink:"/docs/dockerinstall/ironbank"}},d={},i=[{value:"Rocky Linux 8",id:"rocky-linux-8",level:2},{value:"RHEL 8",id:"rhel-8",level:2},{value:"RHEL 7",id:"rhel-7",level:2},{value:"Ubuntu and Raspberry Pi OS",id:"ubuntu-and-raspberry-pi-os",level:2},{value:"Centos 7",id:"centos-7",level:2}];function c(e){const s={code:"code",em:"em",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,n.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h1,{id:"two-server-upgrade",children:"Two-Server Upgrade"}),"\n",(0,r.jsx)(s.h2,{id:"rocky-linux-8",children:"Rocky Linux 8"}),"\n",(0,r.jsx)(s.p,{children:"Upgrade the two TAK Server  packages on the servers on which they are installed."}),"\n",(0,r.jsx)(s.p,{children:"First, on the core server, install Java 17 and upgrade the core package:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo dnf install java-17-openjdk-devel -y\nsudo dnf install takserver-core-5.1-RELEASEx.noarch.rpm -y\n"})}),"\n",(0,r.jsx)(s.p,{children:"Next, on the database server, upgrade the database. Setup the extra postgres yum repo for the latest postgres and postgis. Disable the postgresql stream to install the specific postgres version we depend on. Install Java 17. Enable the 'powertools' repo for postgis dependencies. Install TAK Server RPM database and its dependencies."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo dnf install epel-release -y\nsudo dnf install https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm -y\nsudo dnf update -y\nsudo dnf module disable postgresql\nsudo dnf install java-17-openjdk-devel -y\nsudo dnf config-manager --set-enabled powertools\n"})}),"\n",(0,r.jsx)(s.p,{children:"Make sure the database RPM is in the current directory"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo dnf install takserver-database-5.1-RELEASE-x.noarch.rpm --setopt=clean_requirements_on_remove=false -y\n"})}),"\n",(0,r.jsx)(s.p,{children:"This command will make a copy of your existing Postgresql database and update it to version 15.  If there is an issue with the upgraded database, you can fall back to the copy of the previous version.   If  the upgrade succeeds, there will be a delete_old_cluster.sh script automatically created that you can run to safely remove the previous version's data copy."}),"\n",(0,r.jsx)(s.p,{children:"Check Java version in both servers"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"java -version\n"})}),"\n",(0,r.jsx)(s.p,{children:"This should tell you have 17.x.y. If the command tells you your Java version is not 17.x.y, then you can use the alternatives command to change it:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo alternatives --config java\n"})}),"\n",(0,r.jsx)(s.h2,{id:"rhel-8",children:"RHEL 8"}),"\n",(0,r.jsx)(s.p,{children:"Upgrade the two TAK Server  packages on the servers on which they are installed."}),"\n",(0,r.jsx)(s.p,{children:"First, on the core server, install Java 17 and upgrade the core package:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo dnf update -y && sudo dnf install java-17-openjdk-devel -y\nsudo dnf install takserver-core-5.1-RELEASEx.noarch.rpm -y\n"})}),"\n",(0,r.jsx)(s.p,{children:"Next, on the database server, upgrade the database. Setup the extra postgres yum repo for the latest postgres and postgis. Install Java 17. Disable the postgresql stream to install the specific postgres version we depend on. Install TAK Server RPM database and its dependencies."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo dnf install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm -y\nsudo dnf install https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm -y\nsudo dnf update -y && sudo dnf install java-17-openjdk-devel -y\nsudo dnf module disable postgresql\nsudo subscription-manager config --rhsm.manage_repos=1\nsudo subscription-manager repos --enable codeready-builder-for-rhel-8-x86_64-rpms\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.em,{children:"Note: If you get the error \u2018This system has no repositories available through subscriptions\u2019, you need to subscribe your system with:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo subscription-manager register --username <your_username> --password <your_password> --auto-attach\n"})}),"\n",(0,r.jsx)(s.p,{children:"Make sure the database RPM is in the current directory"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo dnf install takserver-database-5.1-RELEASE-x.noarch.rpm --setopt=clean_requirements_on_remove=false -y\n"})}),"\n",(0,r.jsx)(s.p,{children:"This command will make a copy of your existing Postgresql database and update it to version 15.  If there is an issue with the upgraded database, you can fall back to the copy of the previous version.   If  the upgrade succeeds, there will be a delete_old_cluster.sh script automatically created that you can run to safely remove the previous version's data copy."}),"\n",(0,r.jsx)(s.p,{children:"Check Java version in both servers"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"java -version\n"})}),"\n",(0,r.jsx)(s.p,{children:"This should tell you have 17.x.y. If the command tells you your Java version is not 17.x.y, then you can use the alternatives command to change it:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo alternatives --config java\n"})}),"\n",(0,r.jsx)(s.h2,{id:"rhel-7",children:"RHEL 7"}),"\n",(0,r.jsx)(s.p,{children:"Install OpenJDK 17 and other dependencies (if you have not previously done so.)"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo yum install -y postgis33_15 postgis33_15-utils\nsudo yum install -y postgresql15-server postgresql15-contrib\nsudo yum install -y https://download.oracle.com/java/17/latest/jdk-17_linux-x64_bin.rpm\n"})}),"\n",(0,r.jsx)(s.p,{children:"Note that the yum package manager does not currently support JDK 17 on RHEL 7. By installing the package manually, you will be responsible for future security updates. For a safer long-term solution, we recommend that you update your OS to RHEL 8 or Rocky Linux 8.\nUpgrade the two TAK Server packages on the servers on which they are installed."}),"\n",(0,r.jsx)(s.p,{children:"First, upgrade the core package:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo rpm -Uvh takserver-core-5.1-RELEASEx.noarch.rpm --nodeps\n"})}),"\n",(0,r.jsx)(s.p,{children:"Next, upgrade the database. Setup the extra postgres yum repo for the latest postgres and postgis.  Install TAK Server RPM database and its dependencies."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm\nsudo yum install https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm -y\nsudo yum update -y\n"})}),"\n",(0,r.jsx)(s.p,{children:"Make sure the database RPM is in the current directory"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo rpm -Uvh takserver-database-5.1-RELEASEx.noarch.rpm --nodeps\n"})}),"\n",(0,r.jsx)(s.p,{children:"This command will make a copy of your existing Postgresql database and update it to version 15.  If there is an issue with the upgraded database, you can fall back to the copy of the previous version.   If  the upgrade succeeds, there will be a delete_old_cluster.sh script automatically created that you can run to safely remove the previous version's data copy."}),"\n",(0,r.jsx)(s.p,{children:"Check Java version in both servers"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"java -version\n"})}),"\n",(0,r.jsx)(s.p,{children:"This should tell you have 17.x.y. If the command tells you your Java version is not 17.x.y, then you can use the alternatives command to change it:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo alternatives --config java\n"})}),"\n",(0,r.jsx)(s.h2,{id:"ubuntu-and-raspberry-pi-os",children:"Ubuntu and Raspberry Pi OS"}),"\n",(0,r.jsx)(s.p,{children:"Upgrade the two TAK Server  packages on the servers on which they are installed."}),"\n",(0,r.jsx)(s.p,{children:"First, upgrade the core package."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo apt install ./takserver-core_5.1-RELEASE-x_all.deb\n"})}),"\n",(0,r.jsx)(s.p,{children:"Next, upgrade the database."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo apt install ./takserver-database_5.1-RELEASE-x_all.deb\n"})}),"\n",(0,r.jsx)(s.p,{children:"This command will make a copy of your existing Postgresql database and update it to version 15.  If there is an issue with the upgraded database, you can fall back to the copy of the previous version.   If  the upgrade succeeds, there will be a delete_old_cluster.sh script automatically created that you can run to safely remove the previous version's data copy."}),"\n",(0,r.jsx)(s.p,{children:"Check Java version in both servers"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"java -version\n"})}),"\n",(0,r.jsx)(s.p,{children:"This should tell you have 17.x.y. If the command tells you your Java version is not 17.x.y, then you can use the alternatives command to change it:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo alternatives --config java\n"})}),"\n",(0,r.jsx)(s.h2,{id:"centos-7",children:"Centos 7"}),"\n",(0,r.jsx)(s.p,{children:"Install OpenJDK 17 and other dependencies (if you have not previously done so.)"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo yum install -y postgis33_15 postgis33_15-utils\nsudo yum install -y postgresql15-server postgresql15-contrib\nsudo yum install -y https://download.oracle.com/java/17/latest/jdk-17_linux-x64_bin.rpm\n"})}),"\n",(0,r.jsx)(s.p,{children:"Note that the yum package manager does not currently support JDK 17 on Centos 7. By installing the package manually, you will be responsible for future security updates. For a safer long-term solution, we recommend that you update your OS to RHEL 8 or Rocky Linux 8."}),"\n",(0,r.jsx)(s.p,{children:"Upgrade the two TAK Server packages on the servers on which they are installed."}),"\n",(0,r.jsx)(s.p,{children:"First, upgrade the core package:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo rpm -Uvh takserver-core-5.1-RELEASEx.noarch.rpm --nodeps\n"})}),"\n",(0,r.jsx)(s.p,{children:"Next, upgrade the database. Setup the extra postgres yum repo for the latest postgres and postgis. Install TAK Server RPM database and its dependencies."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo yum install epel-release -y\nsudo yum install https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm -y\nsudo yum update -y\n"})}),"\n",(0,r.jsx)(s.p,{children:"Make sure the database RPM is in the current directory"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo yum install takserver-database-5.1-RELEASE-x.noarch.rpm --setopt=clean_requirements_on_remove=false -y\n"})}),"\n",(0,r.jsx)(s.p,{children:"This command will make a copy of your existing Postgresql database and update it to version 15.  If there is an issue with the upgraded database, you can fall back to the copy of the previous version.   If  the upgrade succeeds, there will be a delete_old_cluster.sh script automatically created that you can run to safely remove the previous version's data copy."}),"\n",(0,r.jsx)(s.p,{children:"Check Java version in both servers"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"java -version\n"})}),"\n",(0,r.jsx)(s.p,{children:"This should tell you have 17.x.y. If the command tells you your Java version is not 17.x.y, then you can use the alternatives command to change it:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo alternatives --config java\n"})})]})}function h(e={}){const{wrapper:s}={...(0,n.a)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},1151:(e,s,a)=>{a.d(s,{Z:()=>l,a:()=>o});var r=a(7294);const n={},t=r.createContext(n);function o(e){const s=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);